<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <!--<link rel="icon" href="../../favicon.ico">-->

    <title>Guess number</title>

    <!-- Bootstrap core CSS -->
    <link href="GuessNumber/stylesheets/bootstrap.min.css" rel="stylesheet">

    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <!--<link href="../../assets/css/ie10-viewport-bug-workaround.css" rel="stylesheet">-->

    <!-- Custom styles for this template -->
    <link href="GuessNumber/stylesheets/dashboard.css" rel="stylesheet">

    <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
    <!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
    <!--<script src="../../assets/js/ie-emulation-modes-warning.js"></script>-->

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/datepicker/0.6.5/datepicker.min.css">
</head>

<body>

    <nav class="navbar navbar-inverse navbar-fixed-top">
        <div class="container-fluid">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar"
                    aria-expanded="false" aria-controls="navbar">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="#">Project name</a>
            </div>
            <div id="navbar" class="navbar-collapse collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li><a href="#">Dashboard</a></li>
                    <li><a href="#">Settings</a></li>
                    <li><a href="#">Profile</a></li>
                    <li><a href="#">Help</a></li>
                </ul>
                <form class="navbar-form navbar-right">
                    <input type="text" class="form-control" placeholder="Search...">
                </form>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <div class="col-sm-3 col-md-2 sidebar">
                <ul class="nav nav-sidebar">
                    <li class="active"><a href="#">Overview <span class="sr-only">(current)</span></a></li>
                    <li><a href="#">Reports</a></li>
                    <li><a href="#">Analytics</a></li>
                    <li><a href="#">Export</a></li>
                </ul>
                <ul class="nav nav-sidebar">
                    <li><a href="">Nav item</a></li>
                    <li><a href="">Nav item again</a></li>
                    <li><a href="">One more nav</a></li>
                    <li><a href="">Another nav item</a></li>
                    <li><a href="">More navigation</a></li>
                </ul>
                <ul class="nav nav-sidebar">
                    <li><a href="">Nav item again</a></li>
                    <li><a href="">One more nav</a></li>
                    <li><a href="">Another nav item</a></li>
                </ul>
            </div>
            <div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-12">
                            <h1>生命靈數</h1>
                            <br>
                            <div class="input-group">
                                <input id="userGuess" type="text" name="" class="form-control" value=""
                                    required="required" placeholder="請輸入日期">
                                <span class="input-group-btn">
                                    <a id="guess" type="button" class="btn btn-info">分析結果</a>
                                </span>
                            </div>
                            <div class="result">

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <!--<script>window.jQuery || document.write('<script src="../../assets/js/vendor/jquery.min.js"><\/script>')</script>-->
    <!-- <script src="scripts/bootstrap.min.js"></script> -->
    <!-- Just to make our placeholder images work. Don't actually copy the next line! -->
    <!--<script src="../../assets/js/vendor/holder.min.js"></script>-->
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <!--<script src="../../assets/js/ie10-viewport-bug-workaround.js"></script>-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/datepicker/0.6.5/datepicker.min.js"></script>
    <script>
        var array = []
        var context = ''
        $(() => {
            setLanguage()
            $('#userGuess').datepicker({
                language: 'zh-CN'
            })
            $('#guess').click(getResult)
            // 若不設延時,日期還沒改變就會執行 getResult()
            $('#userGuess').on('hide.datepicker',() => {setTimeout(getResult,1)})
        })
        class horoscope {
            constructor(name, year, dateceilMonth, dateceilDay) {
                this.name = name
                this.dateceil = new Date(year, dateceilMonth, dateceilDay)
            }
        }
        //  建資料
        function setData(year) {
            array.push(new horoscope('capricorn', year, 0, 19))
            array.push(new horoscope('aquarius', year, 1, 18))
            array.push(new horoscope('pisces', year, 2, 20))
            array.push(new horoscope('aries', year, 3, 20))
            array.push(new horoscope('taurus', year, 4, 20))
            array.push(new horoscope('gemini', year, 5, 21))
            array.push(new horoscope('cancer', year, 6, 22))
            array.push(new horoscope('leo', year, 7, 22))
            array.push(new horoscope('virgo', year, 8, 22))
            array.push(new horoscope('libra', year, 9, 23))
            array.push(new horoscope('scorpio', year, 10, 22))
            array.push(new horoscope('sagittarius', year, 11, 21))
            array.push(new horoscope('capricorn', year, 11, 31))
        }
        // 設定顯示 datepicker 之格式
        function setLanguage() {
            $.fn.datepicker.languages['zh-CN'] = {
                format: 'yyyy/mm/dd',
                daysMin: ['日', '一', '二', '三', '四', '五', '六'],
                monthsShort: ['1月', '2月', '3月', '4月', '5月', '6月', '7月', '8月', '9月', '10月', '11月', '12月'],
                weekStart: 1,
                startView: 2,
                yearFirst: true,
                yearSuffix: '年',
                autoHide: true
            }
        }

        function callapi(horoname, lifenumber) {
            $.ajax({
                type: 'get',
                url: `https://buildschoolnumerology.azurewebsites.net/api/Number/Numerology?constellation=${horoname}`,
                dataType: 'json',
                success: (response) => {
                    $('.result').append(`<div class='list-group-item'>
                                            <span style='background-color:Aqua'>${context.replace(/\//g, '-')}</span> 出生的你 星座是${response.name}
                                            <button type="button" class="close">&times;</button>
                                            <br>
                                            你的生命靈數:
                                            <br>
                                            ${lifenumber}.${response.lookup[lifenumber-1]}
                                        </div>
                                        `)
                    // 點選 X 可關掉該紀錄
                    $('.close').click(function() {
                        $(this).parent().remove()
                    })
                }
            })
        }

        function getResult() {
            context = $('#userGuess').val()
            let date = Date.parse(context)
            // 正則表達式去掉所有的 /
            let sum = parseInt(context.replace(/\//g, ''), 10)
            // 取得輸入的生命靈數
            while (sum > 9) {
                sum = Math.floor(sum / 10) + sum % 10
            }
            // 取年分建資料
            setData(parseInt(context.split('/')[0], 10))
            // 取得輸入的星座
            $.each(array, (i, element) => {
                array = []
                if (date <= element.dateceil) {
                    callapi(element.name, sum)
                    return false
                }
            })
        }
    </script>

</body>

</html>